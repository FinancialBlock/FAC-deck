{"ast":null,"code":"var _jsxFileName = \"/Users/btuck/Desktop/Market/FAC/src/components/Orderbook.jsx\";\nimport { Col, Row } from 'antd';\nimport React, { useRef, useEffect, useState } from 'react';\nimport styled, { css } from 'styled-components';\nimport { useMarket, useOrderbook, useMarkPrice } from '../utils/markets';\nimport { isEqual, getDecimalCount } from '../utils/utils';\nimport { useInterval } from '../utils/useInterval';\nimport FloatingElement from './layout/FloatingElement';\nimport usePrevious from '../utils/usePrevious';\nimport { ArrowUpOutlined, ArrowDownOutlined } from '@ant-design/icons';\nconst Title = styled.div`\n  color: rgba(255, 255, 255, 1);\n`;\nconst SizeTitle = styled(Row)`\n  padding: 20px 0 14px;\n  color: #434a59;\n`;\nconst MarkPriceTitle = styled(Row)`\n  padding: 20px 0 14px;\n  font-weight: 700;\n`;\nconst Line = styled.div`\n  text-align: right;\n  float: right;\n  height: 100%;\n  ${props => props['data-width'] && css`\n      width: ${props['data-width']};\n    `}\n  ${props => props['data-bgcolor'] && css`\n      background-color: ${props['data-bgcolor']};\n    `}\n`;\nconst Price = styled.div`\n  position: absolute;\n  right: 5px;\n  color: white;\n`;\nexport default function Orderbook(_ref) {\n  let {\n    smallScreen,\n    depth = 7,\n    onPrice,\n    onSize\n  } = _ref;\n  const markPrice = useMarkPrice();\n  const [orderbook] = useOrderbook();\n  const {\n    baseCurrency,\n    quoteCurrency\n  } = useMarket();\n  const currentOrderbookData = useRef(null);\n  const lastOrderbookData = useRef(null);\n  const [orderbookData, setOrderbookData] = useState(null);\n  useInterval(() => {\n    if (!currentOrderbookData.current || JSON.stringify(currentOrderbookData.current) !== JSON.stringify(lastOrderbookData.current)) {\n      let bids = (orderbook === null || orderbook === void 0 ? void 0 : orderbook.bids) || [];\n      let asks = (orderbook === null || orderbook === void 0 ? void 0 : orderbook.asks) || [];\n\n      let sum = (total, _ref2, index) => {\n        let [, size] = _ref2;\n        return index < depth ? total + size : total;\n      };\n\n      let totalSize = bids.reduce(sum, 0) + asks.reduce(sum, 0);\n      let bidsToDisplay = getCumulativeOrderbookSide(bids, totalSize, false);\n      let asksToDisplay = getCumulativeOrderbookSide(asks, totalSize, true);\n      currentOrderbookData.current = {\n        bids: orderbook === null || orderbook === void 0 ? void 0 : orderbook.bids,\n        asks: orderbook === null || orderbook === void 0 ? void 0 : orderbook.asks\n      };\n      setOrderbookData({\n        bids: bidsToDisplay,\n        asks: asksToDisplay\n      });\n    }\n  }, 250);\n  useEffect(() => {\n    lastOrderbookData.current = {\n      bids: orderbook === null || orderbook === void 0 ? void 0 : orderbook.bids,\n      asks: orderbook === null || orderbook === void 0 ? void 0 : orderbook.asks\n    };\n  }, [orderbook]);\n\n  function getCumulativeOrderbookSide(orders, totalSize) {\n    let backwards = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n    let cumulative = orders.slice(0, depth).reduce((cumulative, _ref3, i) => {\n      var _cumulative;\n\n      let [price, size] = _ref3;\n      const cumulativeSize = (((_cumulative = cumulative[i - 1]) === null || _cumulative === void 0 ? void 0 : _cumulative.cumulativeSize) || 0) + size;\n      cumulative.push({\n        price,\n        size,\n        cumulativeSize,\n        sizePercent: Math.round(cumulativeSize / (totalSize || 1) * 100)\n      });\n      return cumulative;\n    }, []);\n\n    if (backwards) {\n      cumulative = cumulative.reverse();\n    }\n\n    return cumulative;\n  }\n\n  return /*#__PURE__*/React.createElement(FloatingElement, {\n    style: smallScreen ? {\n      flex: 1\n    } : {\n      height: '500px',\n      overflow: 'hidden'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 7\n    }\n  }, \"Orderbook\"), /*#__PURE__*/React.createElement(SizeTitle, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    span: 12,\n    style: {\n      textAlign: 'left'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 9\n    }\n  }, \"Size (\", baseCurrency, \")\"), /*#__PURE__*/React.createElement(Col, {\n    span: 12,\n    style: {\n      textAlign: 'right'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 9\n    }\n  }, \"Price (\", quoteCurrency, \")\")), orderbookData === null || orderbookData === void 0 ? void 0 : orderbookData.asks.map(_ref4 => {\n    let {\n      price,\n      size,\n      sizePercent\n    } = _ref4;\n    return /*#__PURE__*/React.createElement(OrderbookRow, {\n      key: price + '',\n      price: price,\n      size: size,\n      side: 'sell',\n      sizePercent: sizePercent,\n      onPriceClick: () => onPrice(price),\n      onSizeClick: () => onSize(size),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 9\n      }\n    });\n  }), /*#__PURE__*/React.createElement(MarkPriceComponent, {\n    markPrice: markPrice,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 7\n    }\n  }), orderbookData === null || orderbookData === void 0 ? void 0 : orderbookData.bids.map(_ref5 => {\n    let {\n      price,\n      size,\n      sizePercent\n    } = _ref5;\n    return /*#__PURE__*/React.createElement(OrderbookRow, {\n      key: price + '',\n      price: price,\n      size: size,\n      side: 'buy',\n      sizePercent: sizePercent,\n      onPriceClick: () => onPrice(price),\n      onSizeClick: () => onSize(size),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 136,\n        columnNumber: 9\n      }\n    });\n  }));\n}\nconst OrderbookRow = React.memo(_ref6 => {\n  let {\n    side,\n    price,\n    size,\n    sizePercent,\n    onSizeClick,\n    onPriceClick\n  } = _ref6;\n  const element = useRef();\n  const {\n    market\n  } = useMarket();\n  useEffect(() => {\n    var _element$current, _element$current2;\n\n    // eslint-disable-next-line\n    !((_element$current = element.current) === null || _element$current === void 0 ? void 0 : _element$current.classList.contains('flash')) && ((_element$current2 = element.current) === null || _element$current2 === void 0 ? void 0 : _element$current2.classList.add('flash'));\n    const id = setTimeout(() => {\n      var _element$current3, _element$current4;\n\n      return ((_element$current3 = element.current) === null || _element$current3 === void 0 ? void 0 : _element$current3.classList.contains('flash')) && ((_element$current4 = element.current) === null || _element$current4 === void 0 ? void 0 : _element$current4.classList.remove('flash'));\n    }, 250);\n    return () => clearTimeout(id);\n  }, [price, size]);\n  let formattedSize = (market === null || market === void 0 ? void 0 : market.minOrderSize) && !isNaN(size) ? Number(size).toFixed(getDecimalCount(market.minOrderSize) + 1) : size;\n  let formattedPrice = (market === null || market === void 0 ? void 0 : market.tickSize) && !isNaN(price) ? Number(price).toFixed(getDecimalCount(market.tickSize) + 1) : price;\n  return /*#__PURE__*/React.createElement(Row, {\n    ref: element,\n    style: {\n      marginBottom: 1\n    },\n    onClick: onSizeClick,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    span: 12,\n    style: {\n      textAlign: 'left'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 9\n    }\n  }, formattedSize), /*#__PURE__*/React.createElement(Col, {\n    span: 12,\n    style: {\n      textAlign: 'right'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Line, {\n    \"data-width\": sizePercent + '%',\n    \"data-bgcolor\": side === 'buy' ? 'rgba(65, 199, 122, 0.6)' : 'rgba(242, 60, 105, 0.6)',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 185,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(Price, {\n    onClick: onPriceClick,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 11\n    }\n  }, formattedPrice)));\n}, (prevProps, nextProps) => isEqual(prevProps, nextProps, ['price', 'size', 'sizePercent']));\nconst MarkPriceComponent = React.memo(_ref7 => {\n  let {\n    markPrice\n  } = _ref7;\n  const {\n    market\n  } = useMarket();\n  const previousMarkPrice = usePrevious(markPrice);\n  let markPriceColor = markPrice > previousMarkPrice ? '#41C77A' : markPrice < previousMarkPrice ? '#F23B69' : 'white';\n  let formattedMarkPrice = markPrice && (market === null || market === void 0 ? void 0 : market.tickSize) && markPrice.toFixed(getDecimalCount(market.tickSize));\n  return /*#__PURE__*/React.createElement(MarkPriceTitle, {\n    justify: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    style: {\n      color: markPriceColor\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 9\n    }\n  }, markPrice > previousMarkPrice && /*#__PURE__*/React.createElement(ArrowUpOutlined, {\n    style: {\n      marginRight: 5\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 223,\n      columnNumber: 13\n    }\n  }), markPrice < previousMarkPrice && /*#__PURE__*/React.createElement(ArrowDownOutlined, {\n    style: {\n      marginRight: 5\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 13\n    }\n  }), formattedMarkPrice || '----'));\n}, (prevProps, nextProps) => isEqual(prevProps, nextProps, ['markPrice']));","map":{"version":3,"sources":["/Users/btuck/Desktop/Market/FAC/src/components/Orderbook.jsx"],"names":["Col","Row","React","useRef","useEffect","useState","styled","css","useMarket","useOrderbook","useMarkPrice","isEqual","getDecimalCount","useInterval","FloatingElement","usePrevious","ArrowUpOutlined","ArrowDownOutlined","Title","div","SizeTitle","MarkPriceTitle","Line","props","Price","Orderbook","smallScreen","depth","onPrice","onSize","markPrice","orderbook","baseCurrency","quoteCurrency","currentOrderbookData","lastOrderbookData","orderbookData","setOrderbookData","current","JSON","stringify","bids","asks","sum","total","index","size","totalSize","reduce","bidsToDisplay","getCumulativeOrderbookSide","asksToDisplay","orders","backwards","cumulative","slice","i","price","cumulativeSize","push","sizePercent","Math","round","reverse","flex","height","overflow","textAlign","map","OrderbookRow","memo","side","onSizeClick","onPriceClick","element","market","classList","contains","add","id","setTimeout","remove","clearTimeout","formattedSize","minOrderSize","isNaN","Number","toFixed","formattedPrice","tickSize","marginBottom","prevProps","nextProps","MarkPriceComponent","previousMarkPrice","markPriceColor","formattedMarkPrice","color","marginRight"],"mappings":"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","sourcesContent":["import { Col, Row } from 'antd';\nimport React, { useRef, useEffect, useState } from 'react';\nimport styled, { css } from 'styled-components';\nimport { useMarket, useOrderbook, useMarkPrice } from '../utils/markets';\nimport { isEqual, getDecimalCount } from '../utils/utils';\nimport { useInterval } from '../utils/useInterval';\nimport FloatingElement from './layout/FloatingElement';\nimport usePrevious from '../utils/usePrevious';\nimport { ArrowUpOutlined, ArrowDownOutlined } from '@ant-design/icons';\n\nconst Title = styled.div`\n  color: rgba(255, 255, 255, 1);\n`;\n\nconst SizeTitle = styled(Row)`\n  padding: 20px 0 14px;\n  color: #434a59;\n`;\n\nconst MarkPriceTitle = styled(Row)`\n  padding: 20px 0 14px;\n  font-weight: 700;\n`;\n\nconst Line = styled.div`\n  text-align: right;\n  float: right;\n  height: 100%;\n  ${(props) =>\n    props['data-width'] &&\n    css`\n      width: ${props['data-width']};\n    `}\n  ${(props) =>\n    props['data-bgcolor'] &&\n    css`\n      background-color: ${props['data-bgcolor']};\n    `}\n`;\n\nconst Price = styled.div`\n  position: absolute;\n  right: 5px;\n  color: white;\n`;\n\nexport default function Orderbook({ smallScreen, depth = 7, onPrice, onSize }) {\n  const markPrice = useMarkPrice();\n  const [orderbook] = useOrderbook();\n  const { baseCurrency, quoteCurrency } = useMarket();\n\n  const currentOrderbookData = useRef(null);\n  const lastOrderbookData = useRef(null);\n\n  const [orderbookData, setOrderbookData] = useState(null);\n\n  useInterval(() => {\n    if (\n      !currentOrderbookData.current ||\n      JSON.stringify(currentOrderbookData.current) !==\n        JSON.stringify(lastOrderbookData.current)\n    ) {\n      let bids = orderbook?.bids || [];\n      let asks = orderbook?.asks || [];\n\n      let sum = (total, [, size], index) =>\n        index < depth ? total + size : total;\n      let totalSize = bids.reduce(sum, 0) + asks.reduce(sum, 0);\n\n      let bidsToDisplay = getCumulativeOrderbookSide(bids, totalSize, false);\n      let asksToDisplay = getCumulativeOrderbookSide(asks, totalSize, true);\n\n      currentOrderbookData.current = {\n        bids: orderbook?.bids,\n        asks: orderbook?.asks,\n      };\n\n      setOrderbookData({ bids: bidsToDisplay, asks: asksToDisplay });\n    }\n  }, 250);\n\n  useEffect(() => {\n    lastOrderbookData.current = {\n      bids: orderbook?.bids,\n      asks: orderbook?.asks,\n    };\n  }, [orderbook]);\n\n  function getCumulativeOrderbookSide(orders, totalSize, backwards = false) {\n    let cumulative = orders\n      .slice(0, depth)\n      .reduce((cumulative, [price, size], i) => {\n        const cumulativeSize = (cumulative[i - 1]?.cumulativeSize || 0) + size;\n        cumulative.push({\n          price,\n          size,\n          cumulativeSize,\n          sizePercent: Math.round((cumulativeSize / (totalSize || 1)) * 100),\n        });\n        return cumulative;\n      }, []);\n    if (backwards) {\n      cumulative = cumulative.reverse();\n    }\n    return cumulative;\n  }\n\n  return (\n    <FloatingElement\n      style={\n        smallScreen ? { flex: 1 } : { height: '500px', overflow: 'hidden' }\n      }\n    >\n      <Title>Orderbook</Title>\n      <SizeTitle>\n        <Col span={12} style={{ textAlign: 'left' }}>\n          Size ({baseCurrency})\n        </Col>\n        <Col span={12} style={{ textAlign: 'right' }}>\n          Price ({quoteCurrency})\n        </Col>\n      </SizeTitle>\n      {orderbookData?.asks.map(({ price, size, sizePercent }) => (\n        <OrderbookRow\n          key={price + ''}\n          price={price}\n          size={size}\n          side={'sell'}\n          sizePercent={sizePercent}\n          onPriceClick={() => onPrice(price)}\n          onSizeClick={() => onSize(size)}\n        />\n      ))}\n      <MarkPriceComponent markPrice={markPrice} />\n      {orderbookData?.bids.map(({ price, size, sizePercent }) => (\n        <OrderbookRow\n          key={price + ''}\n          price={price}\n          size={size}\n          side={'buy'}\n          sizePercent={sizePercent}\n          onPriceClick={() => onPrice(price)}\n          onSizeClick={() => onSize(size)}\n        />\n      ))}\n    </FloatingElement>\n  );\n}\n\nconst OrderbookRow = React.memo(\n  ({ side, price, size, sizePercent, onSizeClick, onPriceClick }) => {\n    const element = useRef();\n\n    const { market } = useMarket();\n\n    useEffect(() => {\n      // eslint-disable-next-line\n      !element.current?.classList.contains('flash') &&\n        element.current?.classList.add('flash');\n      const id = setTimeout(\n        () =>\n          element.current?.classList.contains('flash') &&\n          element.current?.classList.remove('flash'),\n        250,\n      );\n      return () => clearTimeout(id);\n    }, [price, size]);\n\n    let formattedSize =\n      market?.minOrderSize && !isNaN(size)\n        ? Number(size).toFixed(getDecimalCount(market.minOrderSize) + 1)\n        : size;\n\n    let formattedPrice =\n      market?.tickSize && !isNaN(price)\n        ? Number(price).toFixed(getDecimalCount(market.tickSize) + 1)\n        : price;\n\n    return (\n      <Row ref={element} style={{ marginBottom: 1 }} onClick={onSizeClick}>\n        <Col span={12} style={{ textAlign: 'left' }}>\n          {formattedSize}\n        </Col>\n        <Col span={12} style={{ textAlign: 'right' }}>\n          <Line\n            data-width={sizePercent + '%'}\n            data-bgcolor={\n              side === 'buy'\n                ? 'rgba(65, 199, 122, 0.6)'\n                : 'rgba(242, 60, 105, 0.6)'\n            }\n          />\n          <Price onClick={onPriceClick}>{formattedPrice}</Price>\n        </Col>\n      </Row>\n    );\n  },\n  (prevProps, nextProps) =>\n    isEqual(prevProps, nextProps, ['price', 'size', 'sizePercent']),\n);\n\nconst MarkPriceComponent = React.memo(\n  ({ markPrice }) => {\n    const { market } = useMarket();\n    const previousMarkPrice = usePrevious(markPrice);\n\n    let markPriceColor =\n      markPrice > previousMarkPrice\n        ? '#41C77A'\n        : markPrice < previousMarkPrice\n        ? '#F23B69'\n        : 'white';\n\n    let formattedMarkPrice =\n      markPrice &&\n      market?.tickSize &&\n      markPrice.toFixed(getDecimalCount(market.tickSize));\n\n    return (\n      <MarkPriceTitle justify=\"center\">\n        <Col style={{ color: markPriceColor }}>\n          {markPrice > previousMarkPrice && (\n            <ArrowUpOutlined style={{ marginRight: 5 }} />\n          )}\n          {markPrice < previousMarkPrice && (\n            <ArrowDownOutlined style={{ marginRight: 5 }} />\n          )}\n          {formattedMarkPrice || '----'}\n        </Col>\n      </MarkPriceTitle>\n    );\n  },\n  (prevProps, nextProps) => isEqual(prevProps, nextProps, ['markPrice']),\n);\n"]},"metadata":{},"sourceType":"module"}